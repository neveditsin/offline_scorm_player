<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>Offline SCORM player</title>

<script src="js/2004/SCOBotUtil.js" type="text/javascript" charset="utf-8"></script>
<script src="js/2004/SCOBotBase.js" type="text/javascript" charset="utf-8"></script>
<script src="js/2004/ScormAPI.js" type="text/javascript" charset="utf-8"></script>

<link rel="stylesheet" href="css/style.css">



<script type="text/javascript">        
    scorm = new SCOBotBase();

	
</script>


<script type="text/javascript">



(function(){		
    	this.Funcs = {
			
			getToc:function()
			{
				const href = new URL(window.location.href);
				const hash = href.searchParams.get("hash");
				console.log(hash);
				const Url="http://localhost:8080/lrs/scanner/module?hash="+encodeURIComponent(hash);
				const Parameters={
						method:"GET"
				};
				fetch(Url, Parameters)
				.then(res => res.json())
				.then((out) => {
					console.log('Output: ', out);
					var toc = document.getElementById("toc");
					for(var i in out)
					{
						let te = out[i];
						if(te.hasOwnProperty('header')){
							let header = te.header;
							console.log(header);
						} else {
							let name = te.name;
							console.log(name);
							let a = document.createElement("a");
							let br = document.createElement("br");
							a.innerHTML = te.name;
							a.setAttribute("onclick",`Funcs.openWindow('${te.link}','${te.name}','${te.type}','${te.data_from_lms}')`);
							toc.appendChild(a);
							toc.appendChild(br);
						}
					}
				}).catch(err => console.error(err));
			},

			
			sendRq:function(user,module,call,ver,cmi)
			{
			    const dat = {
					 user:user,
					 module:module,
					 api_call:call,
					 ver:ver,
					 cmi:cmi,
					 wname:appWindow.name,
				};
				const Url="http://localhost:8080/lrs/scorm";
				const Parameters={
						headers:{
							"content-type":"application/json; charset=UTF-8"
						},
						body:JSON.stringify(dat),
						method:"PUT"
				};
				fetch(Url,Parameters)
				.then(res=>{console.log(res)})
				.catch(error=>console.log(error));
			},

			openWindow:function(winURL,winName,type,datafromlms)
			{
				console.log(decodeURI(type));
				if(decodeURI(type) === "SCORM 1.2"){
					API = new SCOBOTAPIAdaptor12(decodeURI(datafromlms));
				} else{
					API_1484_11 = new SCOBot_API_1484_11(decodeURI(datafromlms));
				}
				
				document.getElementById('scoiFrame').src = winURL;
				appWindow = document.getElementById('scoiFrame').contentWindow;
 				appWindow.addEventListener('unload', API.LMSFinish, true);
 				appWindow.addEventListener('onbeforeunload', API.LMSFinish, false);

				return appWindow
			}

		}

})();



</script>




<style>
.container {
    width:100%;
    text-align:center;
}

.left {
    float:left;
    width:40%;
}


.right {
    float:right;
    width:100%;
}
</style>
</head>
<body>

<div id="header">
	<h1>Offline SCORM player</h1>
</div>
<div class="container">
</div>
<div id="toc" class="left">
</div>


</div class="right">

<iframe id ="scoiFrame" src="/blank.html" height="600" width="800"></iframe>

</div>
</div>

</body>

<script>
	window.onload = Funcs.getToc()
</script>

</html>
